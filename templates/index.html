<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{.title}}</title>
    <link rel="stylesheet" href="/static/css/style.css">
</head>
<body>
    <div class="app-container">
        <!-- Header -->
        <header class="header">
            <div class="header-content">
                <div class="logo">
                    <span class="logo-icon">ğŸƒ</span>
                    <span class="logo-text">æ‰¾æœ‹å‹å‡çº§</span>
                </div>
                <nav class="nav">
                    <a href="/" class="nav-link active">é¦–é¡µ</a>
                    <a href="/rules" class="nav-link">è§„åˆ™</a>
                    {{if .loggedIn}}
                        <a href="/game" class="nav-link">æ¸¸æˆå¤§å…</a>
                        <span class="nav-user">{{.user.Username}} ({{.user.Level}}çº§)</span>
                        <button class="btn btn-outline" onclick="logout()">é€€å‡º</button>
                    {{else}}
                        <a href="/login" class="btn btn-outline">ç™»å½•</a>
                        <a href="/register" class="btn btn-primary">æ³¨å†Œ</a>
                    {{end}}
                </nav>
                <button class="mobile-menu-btn" onclick="toggleMobileMenu()">
                    <span></span>
                    <span></span>
                    <span></span>
                </button>
            </div>
        </header>

        <!-- Hero Section -->
        <section class="hero">
            <div class="hero-content">
                <h1 class="hero-title">5äººä¸‰å‰¯ç‰Œ<br>æ‰¾æœ‹å‹å‡çº§</h1>
                <p class="hero-subtitle">ç»å…¸æ‰‘å…‹æ¸¸æˆï¼Œ60åˆ†ä¸€çº§ï¼Œåˆºæ¿€å‡çº§ä½“éªŒ</p>
                <div class="hero-actions">
                    {{if .loggedIn}}
                        <a href="/game" class="btn btn-large btn-primary">è¿›å…¥æ¸¸æˆ</a>
                    {{else}}
                        <a href="/register" class="btn btn-large btn-primary">ç«‹å³æ³¨å†Œ</a>
                        <a href="/rules" class="btn btn-large btn-secondary">æŸ¥çœ‹è§„åˆ™</a>
                    {{end}}
                </div>
            </div>
            <div class="hero-cards">
                <div class="hero-card card-spade">â™ </div>
                <div class="hero-card card-heart">â™¥</div>
                <div class="hero-card card-club">â™£</div>
                <div class="hero-card card-diamond">â™¦</div>
            </div>
        </section>

        <!-- Features Section -->
        <section class="features">
            <div class="container">
                <h2 class="section-title">æ¸¸æˆç‰¹è‰²</h2>
                <div class="feature-grid">
                    <div class="feature-card">
                        <div class="feature-icon">ğŸ‘¥</div>
                        <h3>5äººå¯¹æˆ˜</h3>
                        <p>æ”¯æŒ5äººåŒæ—¶æ¸¸æˆï¼Œæ‰¾æœ‹å‹ç»„é˜Ÿï¼Œ2æ‰“3ç²¾å½©å¯¹å†³</p>
                    </div>
                    <div class="feature-card">
                        <div class="feature-icon">ğŸ´</div>
                        <h3>ä¸‰å‰¯ç‰Œ</h3>
                        <p>162å¼ æ‰‘å…‹ç‰Œï¼Œæ¯äºº31å¼ ï¼Œ7å¼ åº•ç‰Œï¼Œæ›´å¤šç­–ç•¥å¯èƒ½</p>
                    </div>
                    <div class="feature-card">
                        <div class="feature-icon">ğŸ”„</div>
                        <h3>åä¸»æœºåˆ¶</h3>
                        <p>æ”¯æŒå•å¼ ã€å¯¹å­ã€ä¸‰å¼ åä¸»ï¼Œå¤§å°ç‹æ›´æœ‰å¨æ…‘åŠ›</p>
                    </div>
                    <div class="feature-card">
                        <div class="feature-icon">ğŸ“ˆ</div>
                        <h3>å‡çº§ç³»ç»Ÿ</h3>
                        <p>60åˆ†ä¸€çº§ï¼Œä»2æ‰“åˆ°Aï¼Œå…ˆå®Œæˆä¸ºèƒœï¼Œè®°å½•ä½ çš„æˆ˜ç»©</p>
                    </div>
                </div>
            </div>
        </section>

        <!-- Quick Rules Section -->
        <section class="quick-rules">
            <div class="container">
                <h2 class="section-title">å¿«é€Ÿå…¥é—¨</h2>
                <div class="rules-steps">
                    <div class="rule-step">
                        <div class="step-number">1</div>
                        <div class="step-content">
                            <h3>æ³¨å†Œè´¦å·</h3>
                            <p>åˆ›å»ºä½ çš„æ¸¸æˆè´¦å·ï¼Œå¼€å§‹å‡çº§ä¹‹æ—…</p>
                        </div>
                    </div>
                    <div class="rule-step">
                        <div class="step-number">2</div>
                        <div class="step-content">
                            <h3>åˆ›å»ºæˆ¿é—´</h3>
                            <p>åˆ›å»ºæ¸¸æˆæˆ¿é—´æˆ–åŠ å…¥ç°æœ‰æˆ¿é—´</p>
                        </div>
                    </div>
                    <div class="rule-step">
                        <div class="step-number">3</div>
                        <div class="step-content">
                            <h3>æŠ¢åº„äº®ä¸»</h3>
                            <p>äº®å‡ºçº§ç‰ŒæŠ¢åº„ï¼Œåä¸»äº‰å¤ºä¸»èŠ±è‰²</p>
                        </div>
                    </div>
                    <div class="rule-step">
                        <div class="step-number">4</div>
                        <div class="step-content">
                            <h3>æ‰¾æœ‹å‹</h3>
                            <p>åº„å®¶æŒ‡å®šä¸€å¼ ç‰Œï¼Œé¦–ä¸ªæ‰“å‡ºçš„æˆä¸ºç›Ÿå‹</p>
                        </div>
                    </div>
                    <div class="rule-step">
                        <div class="step-number">5</div>
                        <div class="step-content">
                            <h3>å‡ºç‰Œå¾—åˆ†</h3>
                            <p>æŒ‰è§„åˆ™å‡ºç‰Œï¼ŒæŠ¢å¤ºåˆ†æ•°ï¼Œäº‰å–å‡çº§</p>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Footer -->
        <footer class="footer">
            <div class="container">
                <p>&copy; 2024 æ‰¾æœ‹å‹å‡çº§ - ç»å…¸æ‰‘å…‹æ¸¸æˆ</p>
            </div>
        </footer>
    </div>

    <script src="/static/js/app.js"></script>
    <script>
        // Check auth on page load and update header
        document.addEventListener('DOMContentLoaded', async function() {
            const token = localStorage.getItem('token');
            if (token) {
                try {
                    const response = await fetch('/api/user', {
                        headers: { 'Authorization': `Bearer ${token}` }
                    });
                    const result = await response.json();
                    if (result.success) {
                        localStorage.setItem('user', JSON.stringify(result.user));
                        updateHeaderForLoggedIn(result.user);
                    }
                } catch (e) {
                    // Token invalid, clear it
                    localStorage.removeItem('token');
                    localStorage.removeItem('user');
                }
            }
        });

        function updateHeaderForLoggedIn(user) {
            const nav = document.querySelector('.nav');
            // Find the nav items section after links
            const loginBtn = nav.querySelector('a[href="/login"]');
            const registerBtn = nav.querySelector('a[href="/register"]');

            if (loginBtn && registerBtn) {
                // Remove login/register buttons
                loginBtn.remove();
                registerBtn.remove();

                // Add game link and user info
                const gameLink = document.createElement('a');
                gameLink.href = '/game';
                gameLink.className = 'nav-link';
                gameLink.textContent = 'æ¸¸æˆå¤§å…';

                const userSpan = document.createElement('span');
                userSpan.className = 'nav-user';
                userSpan.textContent = `${user.username} (${user.level}çº§)`;

                const logoutBtn = document.createElement('button');
                logoutBtn.className = 'btn btn-outline';
                logoutBtn.textContent = 'é€€å‡º';
                logoutBtn.onclick = logout;

                // Insert after the rules link
                const rulesLink = nav.querySelector('a[href="/rules"]');
                if (rulesLink && rulesLink.nextSibling) {
                    nav.insertBefore(gameLink, rulesLink.nextSibling);
                    nav.insertBefore(userSpan, gameLink.nextSibling);
                    nav.insertBefore(logoutBtn, userSpan.nextSibling);
                }

                // Update hero section
                const heroActions = document.querySelector('.hero-actions');
                if (heroActions) {
                    heroActions.innerHTML = '<a href="/game" class="btn btn-large btn-primary">è¿›å…¥æ¸¸æˆ</a>';
                }
            }
        }
    </script>
</body>
</html>
